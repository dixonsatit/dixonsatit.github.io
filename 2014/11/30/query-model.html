<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>รวมคำสั่ง Query ใน Model ที่ใช้งานบ่อยๆ | Yii 2 Learning</title>
	<meta name="description" content="รวมคำสั่ง Query ใน Model ที่ใช้งานบ่อยๆ | Find()เป็นคำสั่งค้นข้อมูลและส่งค่ากลับมาทีละแถว โดยใช้ primary key โดยสามารถใส่ค่าเข้าไปที่ parameter ของ find() ได้เลย หากค้าแล้วไม่เจอจะคืนค่าเป็น null คล้... Yii2, Yii Framework, Extension, Howto,tutorial">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">

	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/jekyll-github.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="http://dixonsatit.github.io/2014/11/30/query-model.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="Yii 2 Learning" href="http://dixonsatit.github.io/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-63817549-1', 'auto');
	ga('send', 'pageview');
	</script>
	
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="https://secure.gravatar.com/avatar/7037e0cdf96cd3d4ad39b6c32ca29bd7?s=100" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">Yii 2 Learning</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			<li>
				<a class="page-link" href="/about/">
					About
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			<li>
				<a class="page-link" href="/yii2-learning/">
					Yii2 Learning
				</a>
			</li>
			
			
			
			<li>
				<a class="page-link" href="/yii2-tip-tricks.html">
					Yii2 Trip & Tricks
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled -->
			


<li>
	<a href="mailto:dixonsatit@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>









<li>
	<a href="https://www.facebook.com/yii2Learning" title="Follow on Facebook">
		<i class="fa fa-fw fa-facebook"></i>
	</a>
</li>





<li>
	<a href="https://github.com/dixonsatit" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>





















<li>
	<a href="https://twitter.com/dixonsatit" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>






		</ul>
	</nav>
</header>

    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">รวมคำสั่ง Query ใน Model ที่ใช้งานบ่อยๆ</h1>
    <p class="meta">
    November 30, 2014
    
    </p>
  </header>
  <section class="post-content"><h2 id="find">Find()</h2>

<p>เป็นคำสั่งค้นข้อมูลและส่งค่ากลับมาทีละแถว โดยใช้ primary key โดยสามารถใส่ค่าเข้าไปที่ parameter ของ <code>find()</code> ได้เลย หากค้าแล้วไม่เจอจะคืนค่าเป็น <code>null</code> คล้ายกับ <code>findByPk()</code> ใน yii1</p>

<p>ตัวอย่างการใช้งาน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find(45);</span>
<span class="x">if($model){</span>
<span class="x">    echo $model-&gt;username;</span>
<span class="x">    echo $model-&gt;status;</span>
<span class="x">}</span>
</code></pre></div>
<h2 id="all">All()</h2>

<p>เป็นคำสั่งค้นข้อมูลโดยไม่ได้ระบุเงื่อนไขและส่งค่ากับมาทีละหลายๆแถว โดยใช้ <code>method</code> all()</p>

<blockquote>
<p>ในการใช้งานจริงๆ เราสามารถใช้งานร่วมกับ method อื่นได้ เช่น where(),order() การใช้งานดูในตัวอย่างถัดๆ ไป</p>
</blockquote>

<p>ตัวอย่างการใช้งาน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()-&gt;all();</span>
</code></pre></div>
<h2 id="one">One()</h2>

<p>เป็นคำสั่งค้นข้อมูลโดยไม่ได้ระบุเงื่อนไขและส่งค่ากับมาทีละแถว โดยใช้ <code>method</code> one()</p>

<blockquote>
<p>ในการใช้งานจริงๆ เราสามารถใช้งานร่วมกับ method อื่นได้ เช่น where(),order() การใช้งานดูในตัวอย่างถัดๆ ไป</p>
</blockquote>

<p>ตัวอย่างการใช้งาน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()-&gt;one();</span>
</code></pre></div>
<h2 id="where">where()</h2>

<p>เป็นคำสั่งที่ให้เราสามารถเพิ่มเงื่อนไขต่างๆ เข้าไปได้ สามารถใช้ร่วมกัน one() หรือ  all() ได้</p>

<p>ตัวอย่างการใช้งาน where() แบบต่างๆ</p>

<h3 id="sample-1">Sample 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$userid=1;</span>
<span class="x">$model = User::find()</span>
<span class="x">    -&gt;where(&#39;userid &gt; :userid&#39;, [&#39;:userid&#39; =&gt; $userid])</span>
<span class="x">    -&gt;one();</span>
</code></pre></div>
<h3 id="sample-2">Sample 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;where([&#39;reg_date&#39; =&gt; $date, &#39;status&#39; =&gt; 1])</span>
<span class="x">    -&gt;one();</span>
</code></pre></div>
<h3 id="sample-3">Sample 3:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;where(&quot;reg_date &gt; &#39;2014-01-01&#39; and status=1&quot;)</span>
<span class="x">    -&gt;all();</span>
</code></pre></div>
<h3 id="sample-4">Sample 4:</h3>

<p>เป็นการเพิ่มหลายๆ เงื่อนไขต่อกันสามารถระบุได้ว่าเงื่อนไขต่อไปเป็น and,หรือ or</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;where(&#39;userid &gt; :userid&#39;, [&#39;:userid&#39; =&gt; $userid])</span>
<span class="x">    -&gt;orWhere(&#39;primary_user = :primary_user&#39;, [&#39;:primary_user&#39; =&gt; $primary_user])</span>
<span class="x">    -&gt;andWhere(&#39;status = :status&#39;, [&#39;:status&#39; =&gt; $status])</span>
<span class="x">    -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ sql จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="p">((</span><span class="n">userid</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">OR</span> <span class="p">(</span><span class="n">primary_user</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span> <span class="k">AND</span> <span class="p">(</span><span class="n">status</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>
<h2 id="orderby">orderBy()</h2>

<h3 id="sample-1">Sample 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;where([&#39;status&#39; =&gt; 1])</span>
<span class="x">    -&gt;orderBy(&#39;userid&#39;)</span>
<span class="x">    -&gt;all();</span>
</code></pre></div>
<h3 id="sample-2">Sample 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;where([&#39;status&#39; =&gt; 0])</span>
<span class="x">    -&gt;orderBy(&#39;userid&#39;)</span>
<span class="x">    -&gt;one();</span>
</code></pre></div>
<h3 id="sample-3">Sample 3:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">    $model = User::find()</span>
<span class="x">    -&gt;orderBy([</span>
<span class="x">           &#39;usertype&#39;=&gt;SORT_ASC,</span>
<span class="x">           &#39;username&#39; =&gt; SORT_DESC,</span>
<span class="x">        ])</span>
<span class="x">    -&gt;limit(10)</span>
<span class="x">    -&gt;all();</span>
</code></pre></div>
<p>ถ้าดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="o">`</span><span class="n">usertype</span><span class="o">`</span><span class="p">,</span> <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span>
</code></pre></div>
<h2 id="count">count()</h2>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">    $model = User::find()</span>
<span class="x">    -&gt;where([&#39;status&#39; =&gt; 0])</span>
<span class="x">    -&gt;orderBy(&#39;userid&#39;)</span>
<span class="x">    -&gt;count();</span>
</code></pre></div>
<h2 id="asarray">asArray()</h2>

<p>รับค่าข้อมูลกลับมาในรูปแบบของ Array ซึ่งปกติเราจะได้ในรูปแบบ Object</p>

<blockquote>
<p>! หากใช้ asArray() เราจะไม่สามารถเรียกใช้งาน $model-&gt;username แบบนี้ได้ ต้องเป็น $model[&#39;username&#39;]  ต้องเลือกให้เหมาะกันงานที่จะนำมาใช้นะครับ</p>
</blockquote>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;asArray()</span>
<span class="x">    -&gt;all();</span>
</code></pre></div><div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">    -&gt;asArray()</span>
<span class="x">    -&gt;one();</span>
</code></pre></div>
<h2 id="indexby">indexBy()</h2>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">-&gt;indexBy(&#39;id&#39;)</span>
<span class="x">-&gt;one();</span>
</code></pre></div>
<h2 id="limit">limit()</h2>

<h3 id="sample-1">Sample 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">-&gt;limit(10)</span>
<span class="x">-&gt;all();</span>
</code></pre></div>
<h3 id="sample-2">Sample 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">-&gt;where(&#39;userid &gt; 1 and isactive=1&#39;)</span>
<span class="x">-&gt;limit(2)</span>
<span class="x">-&gt;all();</span>
</code></pre></div>
<h2 id="offset">offset()</h2>

<p>เป็นคำสั่งเรียกข้อมูล 5 แถว โดยเริ่มที่ แถวที่ 10
<code>php
$model = User::find()
        -&gt;limit(5)
        -&gt;offset(10)
        -&gt;all();
</code></p>

<p>ดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">LIMIT</span> <span class="mi">5</span> <span class="k">OFFSET</span> <span class="mi">10</span>
</code></pre></div>
<h2 id="limit-with-pagination">Limit With Pagination()</h2>

<p>เป็นการใช้งาน model ร่วมกับ pagination สามารถตั้งค่า <code>defaultPateSize</code> ได้</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$query = Country::find();</span>
<span class="x">$pagination = new Pagination([</span>
<span class="x">            &#39;defaultPageSize&#39; =&gt; 5,</span>
<span class="x">      &#39;totalCount&#39; =&gt; $query-&gt;count(),</span>
<span class="x">        ]);</span>

<span class="x">$countries = $query-&gt;orderBy(&#39;name&#39;)</span>
<span class="x">    -&gt;offset($pagination-&gt;offset)</span>
<span class="x">    -&gt;limit($pagination-&gt;limit)</span>
<span class="x">    -&gt;all();</span>
</code></pre></div>
<h2 id="lile-condition">LILE Condition()</h2>

<p>เป็นการใช้งานคำสั่ง like ส่วนใหญ่เราก็ใช้ในกรณีค้นหาข้อมูล สามารถระบุ % หน้า % หลังได้</p>

<h3 id="sqmple-1">Sqmple 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;where([&#39;LIKE&#39;, &#39;username&#39;, &#39;admin&#39;])</span>
<span class="x">        -&gt;all();</span>
<span class="x">//OR</span>
<span class="x">$model = User::find()</span>
<span class="x">        -&gt;where(&#39;username LIKE :query&#39;)</span>
<span class="x">        -&gt;addParams([&#39;:query&#39;=&gt;&#39;%admin%&#39;])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="k">LIKE</span> <span class="s1">&#39;%admin%&#39;</span>
</code></pre></div>
<h3 id="sqmple-2">Sqmple 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;where([&#39;NOT LIKE&#39;, &#39;username&#39;, &#39;admin&#39;])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="k">NOT</span> <span class="k">LIKE</span> <span class="s1">&#39;%admin%&#39;</span>
</code></pre></div>
<h2 id="in-condition">In Condition()</h2>

<p>In เราสามารถระบบค่าเป็น array ได้เลย</p>

<h3 id="sqmple-1">Sqmple 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;where([</span>
<span class="x">            &#39;userid&#39; =&gt; [1001,1002,1003,1004,1005],</span>
<span class="x">            ])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<h3 id="sqmple-2">Sqmple 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;where([&#39;IN&#39;, &#39;userid&#39;, [1001,1002,1003,1004,1005]])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="o">`</span><span class="n">userid</span><span class="o">`</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">1004</span><span class="p">,</span> <span class="mi">1005</span><span class="p">)</span>
</code></pre></div>
<h3 id="sqmple-3">Sqmple 3:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;where([&#39;NOT IN&#39;, &#39;userid&#39;, [1001,1002,1003,1004,1005]])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="o">`</span><span class="n">userid</span><span class="o">`</span> <span class="k">NOT</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">1004</span><span class="p">,</span> <span class="mi">1005</span><span class="p">)</span>
</code></pre></div>
<h2 id="between">between()</h2>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;select(&#39;username&#39;)</span>
<span class="x">        -&gt;asArray()</span>
<span class="x">        -&gt;where(&#39;userid between 1 and 5&#39;)</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">`</span><span class="n">username</span><span class="o">`</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="n">userid</span> <span class="k">between</span> <span class="mi">1</span> <span class="k">and</span> <span class="mi">5</span>
</code></pre></div>
<h2 id="groupby">groupBy()</h2>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;groupBy(&#39;usertype&#39;)</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>หากดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="o">`</span><span class="n">usertype</span><span class="o">`</span>
</code></pre></div>
<h2 id="having">having()</h2>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$states=1;</span>
<span class="x">$model = User::find()</span>
<span class="x">        -&gt;groupBy(&#39;usertypee&#39;)</span>
<span class="x">        -&gt;having(&#39;states &gt;:states&#39;)</span>
<span class="x">        -&gt;addParams([&#39;:states&#39;=&gt;$states])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div><div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="o">`</span><span class="n">usertypee</span><span class="o">`</span> <span class="k">HAVING</span> <span class="n">states</span> <span class="o">&gt;</span><span class="mi">1</span>
</code></pre></div>
<h2 id="addparams">addParams()</h2>

<p>เป็นการแทนค่าตัวแปรในเงือนไข where</p>

<h3 id="sqmple-1">Sqmple 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$usertype=1;</span>
<span class="x">$model = User::find()</span>
<span class="x">    -&gt;where(&#39;usertype = :usertype&#39;)</span>
<span class="x">    -&gt;addParams([&#39;:usertype&#39; =&gt; $usertype])</span>
<span class="x">    -&gt;one();</span>
</code></pre></div>
<h3 id="sqmple-2">Sqmple 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$usertype=1;</span>
<span class="x">$status=0;</span>
<span class="x">$model = User::find()</span>
<span class="x">    -&gt;where(&#39;usertype = :usertype and status=:status&#39;)</span>
<span class="x">    -&gt;addParams([&#39;:usertype&#39; =&gt; $usertype])</span>
<span class="x">    -&gt;addParams([&#39;:status&#39; =&gt; $status])</span>
<span class="x">// OR Multiple Assigns</span>
<span class="x">// -&gt;addParams([&#39;:usertype&#39; =&gt; $usertype,&#39;:status&#39; =&gt; $status])</span>
<span class="x">    -&gt;one();</span>
</code></pre></div>
<h2 id="multiple-condition">Multiple Condition()</h2>

<p>ในกรณีที่ต้องใช้หลายๆ เงื่อนไข</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$model = User::find()</span>
<span class="x">        -&gt;where([</span>
<span class="x">            &#39;type&#39; =&gt; 26,</span>
<span class="x">            &#39;status&#39; =&gt; 1,</span>
<span class="x">            &#39;userid&#39; =&gt; [1001,1002,1003,1004,1005],</span>
<span class="x">            ])</span>
<span class="x">        -&gt;all();</span>
</code></pre></div>
<p>ดูในรูปแบบ <code>sql</code> จะได้แบบนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="o">`</span><span class="n">tbl_user</span><span class="o">`</span> <span class="k">WHERE</span> <span class="p">(</span><span class="o">`</span><span class="k">type</span><span class="o">`=</span><span class="mi">26</span><span class="p">)</span> <span class="k">AND</span> <span class="p">(</span><span class="o">`</span><span class="n">status</span><span class="o">`=</span><span class="mi">1</span><span class="p">)</span> <span class="k">AND</span> <span class="p">(</span><span class="o">`</span><span class="n">userid</span><span class="o">`</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span> <span class="mi">1002</span><span class="p">,</span> <span class="mi">1003</span><span class="p">,</span> <span class="mi">1004</span><span class="p">,</span> <span class="mi">1005</span><span class="p">))</span>
</code></pre></div>
<h2 id="scope">Scope()</h2>

<p>เป็นการสร้างเงื่อนไขที่เราใช้บ่อยๆ ให้สามารถเรียกใช้งานผ่าน functions ได้</p>

<p>ตามตัวอย่างด้านล่าง เป็นการสร้าง <code>scope</code> ชื่อ <code>olderThen</code> มีการรับค่า parameter 1 ตัว ชื่อ <code>$age</code>และมีการกำหนดค่า default ให้เท่ากับ 5 ในกรณีที่เรียกใช้งานแล้วไม่ได้ใส่ค่ามาด้วย `<code>paramerter มาด้วย</code>$age` จะเท่ากับ 5</p>

<h3 id="sqmple-1">Sqmple 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">class User extends \yii\db\ActiveRecord</span>
<span class="x">{</span>
<span class="x">namespace app\models;</span>
<span class="x">public static function olderThan($age = 5)</span>
<span class="x">{</span>
<span class="x">    $this-&gt;andWhere(&#39;userid &gt; :age&#39;, [&#39;:age&#39; =&gt; $age]);</span>
<span class="x">                            return $this;</span>
<span class="x">}</span>
<span class="x">}</span>
<span class="x">// เรียกใช้งานและระบุค่า ซึ่งค่า `$age` จะเท่ากับ 7</span>
<span class="x">$model = User::find()-&gt;olderThan(7)-&gt;all();</span>

<span class="x">// เรียกใช้งานแบบไม่ระบุค่า ซึ่ง $age จะเท่ากับ 5</span>
<span class="x">$model = User::find()-&gt;olderThan()-&gt;all();</span>
</code></pre></div>
<h3 id="sqmple-2">Sqmple 2:</h3>

<p>ตัวอย่างนี้ไม่้ได้กำหนดค่า default ให้ จะต้องส่งค่ามาเสมอในตอนที่เรียกใช้งาน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">class User extends \yii\db\ActiveRecord</span>
<span class="x">{</span>
<span class="x">    // ...</span>
<span class="x">    public static function active($status)</span>
<span class="x">    {</span>
<span class="x">            $this-&gt;andWhere(&#39;status = &#39;.$status);</span>
<span class="x">            return $this;</span>
<span class="x">    }</span>
<span class="x">}</span>
<span class="x">// call the scope function</span>
<span class="x">$model = User::find()</span>
<span class="x">-&gt;active(1)</span>
<span class="x">-&gt;all();</span>
</code></pre></div>
<h2 id="findbysql">findBySql()</h2>

<p>เป็นการเรียกคำสั่ง sql โดยตรงผ่าน model</p>

<h3 id="sqmple-1">Sqmple 1:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$sql = &#39;SELECT * FROM tbl_user&#39;;</span>
<span class="x">$model = User::findBySql($sql)-&gt;all();</span>
</code></pre></div>
<h3 id="sqmple-2">Sqmple 2:</h3>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">$sql = &#39;SELECT * FROM tbl_user&#39;;</span>
<span class="x">$model = User::findBySql($sql)-&gt;all();</span>
</code></pre></div>
<p><a href="http://www.bsourcecode.com/yiiframework2/select-query-model/#where">ที่มา</a></p>
</section>
</article>

<!-- Post navigation -->


<!-- Disqus -->

<div class="comments">
  <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'dixonsatit';
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>


    </div>
    <script src="/js/main.js"></script>


<footer class="site-footer">
	<p class="text"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Yii2 Learning</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.dimpled.me" property="cc:attributionName" rel="cc:attributionURL">Satit Seethaphon</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="http://dixonsatit.github.io" rel="dct:source">http://dixonsatit.github.io</a><br> Powered by <a href="http://jekyllrb.com">Jekyll</a> with <a href="https://rohanchandra.github.io/project/type/">Type Theme</a>
</p>
</footer>


  </body>
</html>
