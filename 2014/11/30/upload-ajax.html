<!DOCTYPE html>
<html class="no-js">
  <head>
	<meta charset="utf-8">
	<title>สร้างฟอร์ม Upload Files ด้วย AJAX | DixonSatit</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-Frame-Options" content="sameorigin">

	<!-- CSS -->
	<link rel="stylesheet" href="/css/main.css">
	<link rel="stylesheet" href="/css/jekyll-github.css">

	<!--Favicon-->
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

	<!-- Canonical -->
	<link rel="canonical" href="http://dixonsatit.github.io/2014/11/30/upload-ajax.html">

	<!-- RSS -->
	<link rel="alternate" type="application/atom+xml" title="DixonSatit" href="http://dixonsatit.github.io/feed.xml" />

	<!-- Font Awesome -->
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

	<!-- Google Fonts -->
	
	<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,700italic,400italic" rel="stylesheet" type="text/css">
	

	<!-- KaTeX -->
	
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.3.0/katex.min.js"></script>
	

	<!-- Google Analytics -->
	
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-63817549-1', 'auto');
	ga('send', 'pageview');
	</script>
	
</head>

  <body>
    <header class="site-header">
	<div class="branding">
		
		<a href="/">
			<img class="avatar" src="https://secure.gravatar.com/avatar/7037e0cdf96cd3d4ad39b6c32ca29bd7?s=100" alt=""/>
		</a>
		
		<h1 class="site-title">
			<a href="/">DixonSatit</a>
		</h1>
	</div>
	<nav class="site-nav">
		<ul>
			
			
			
			
			<li>
				<a class="page-link" href="/about/">
					About
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			<li>
				<a class="page-link" href="/yii2-learning/">
					Yii2 Learning
				</a>
			</li>
			
			
			
			<li>
				<a class="page-link" href="/yii2-tip-tricks.html">
					Yii2 Trip & Tricks
				</a>
			</li>
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			<!-- Social icons from Font Awesome, if enabled -->
			


<li>
	<a href="mailto:dixonsatit@gmail.com" title="Email">
		<i class="fa fa-fw fa-envelope"></i>
	</a>
</li>









<li>
	<a href="https://www.facebook.com/yii2Learning" title="Follow on Facebook">
		<i class="fa fa-fw fa-facebook"></i>
	</a>
</li>





<li>
	<a href="https://github.com/dixonsatit" title="Follow on GitHub">
		<i class="fa fa-fw fa-github"></i>
	</a>
</li>





















<li>
	<a href="https://twitter.com/dixonsatit" title="Follow on Twitter">
		<i class="fa fa-fw fa-twitter"></i>
	</a>
</li>






		</ul>
	</nav>
</header>

    <div class="content">
      <article >
  <header style="background-image: url('/')">
    <h1 class="title">สร้างฟอร์ม Upload Files ด้วย AJAX</h1>
    <p class="meta">
    November 30, 2014
    
    </p>
  </header>
  <section class="post-content"><hr>

<p><img src="/img/upload-file-ajax.png" alt="upload file"></p>

<p>เชื่อว่าหลายๆ คนคงเคยปวดหัวกับการสร้างฟอร์มเพื่อทำการอัพโหลดไฟล์ต่างๆ หรือไฟล์รูปภาพเองก็ตาม ถ้าเป็นฟอร์มอัพโหลดแบบธรรมดาก็คงไม่เท่าไหร่ แต่ถ้าเป็นแบบ ajax ก็คงจะปวดหัวไม่ใช่น้อย.. T_T&#39; เดี่ยววันเราจะมาลองทำฟอร์ม Upload แบบ ajax กันซึ่งพระเอกของเราวันนี้คือ <a href="http://demos.krajee.com/widgets#fileinput">fileinput</a> เป็น Widget ของ krajee เจ้าเก่า ซึ่งรวมอยู่ในแพ็คเก็จ <a href="http://demos.krajee.com/widgets">Yii2 Widget</a> อยู่แล้ว ติดตั้งทีเดียวได้ครบเลย <sup>^</sup></p>

<p>เราจะเพิ่มการอัพโหลดแบบ ajax คุณสมบัติหลักคือ
- สามารถอัพโหลดได้ทันทีผ่าน  ajax  โดยไม่ต้องรอ create record
- สามารถกดปุ่ม upload ajax ได้ หรือ กด submit ผ่านฟอร์มได้เช่นกัน
- หากเป็นรูปภาพจะสร้าง thumbnail และ resize อัตโนมัติ
- สามารถกดปุ่มลบรายการที่อัพโหลดได้
- เมื่อมีการลบ record จะตามไปลบข้อมูลทั้ง folder ด้วยและลบรายการทั้งหมดที่ตาราง uploads</p>

<h2 id="ติดตั้ง-extension-เพิ่มเติม">ติดตั้ง extension เพิ่มเติม</h2>

<p>เพิ่ม รายชื่อ extension เข้าไปที่ไฟล์ composer.json เพิ่มไว้ภายใต้แท็ก require จากนั้น cd เข้าไปที่ root project ของเราแล้วรันคำสั่ง <code>composer update</code></p>
<div class="highlight"><pre><code class="language-json" data-lang="json"><span class="s2">&quot;kartik-v/yii2-widgets&quot;</span><span class="err">:</span> <span class="s2">&quot;*&quot;</span><span class="err">,</span>
<span class="s2">&quot;yurkinx/yii2-image&quot;</span><span class="err">:</span> <span class="s2">&quot;dev-master&quot;</span><span class="err">,</span>
<span class="s2">&quot;2amigos/yii2-date-picker-widget&quot;</span> <span class="err">:</span> <span class="s2">&quot;~1.0&quot;</span><span class="err">,</span>
<span class="s2">&quot;2amigos/yii2-gallery-widget&quot;</span> <span class="err">:</span> <span class="s2">&quot;*&quot;</span>
</code></pre></div>
<blockquote>
<p>yii2-image ต้องเปิดใช้งานที่ config ในส่วนของ components เพิ่มการตั้งค่าเข้าไป</p>
</blockquote>
<div class="highlight"><pre><code class="language-text" data-lang="text">&#39;image&#39; =&gt; [  
    &#39;class&#39; =&gt; &#39;yii\image\ImageDriver&#39;,
    &#39;driver&#39; =&gt; &#39;GD&#39;,  //GD or Imagick
],
</code></pre></div>
<p><a href="http://dixonsatit.github.io/2014/11/30/upload-ajax.htmls">อ่านเพิ่มเติมได้ที่นี่</a></p>

<h2 id="gii-model-และ-gii-crud-photolibrary">Gii Model และ Gii CRUD PhotoLibrary</h2>

<p>ในตัวอย่างนี้เราจะสร้างระบบเก็บรูปภาพโดยใช้ตารางชื่อว่า photolibrary และสร้างตารางตามนี้</p>
<div class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="o">`</span><span class="n">photo_library</span><span class="o">`</span> <span class="p">(</span>
  <span class="o">`</span><span class="n">id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="o">`</span><span class="k">ref</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;เลข fk กับ upload ใช้กับ upload ajax&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">event_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;ชื่องาน&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">detail</span><span class="o">`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">&#39;รายละเอียด&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">start_date</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;วันที่เริ่มถ่ายภาพ&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">end_date</span><span class="o">`</span> <span class="n">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;วันที่ถ่ายภาพเสร็จ&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="k">location</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;สถานที่&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">customer_name</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;ชื่อลูกค้า&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">customer_mobile_phone</span><span class="o">`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">&#39;เบอร์โทร&#39;</span><span class="p">,</span>
  <span class="o">`</span><span class="n">province_id</span><span class="o">`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="o">`</span><span class="k">ref</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="k">ref</span><span class="o">`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span>
</code></pre></div>
<p>หลังจากสร้างตารางเรียบร้อย ให้ทำการ gii Model PhotoLibrary และ crud PhotoLibrary</p>

<h2 id="สร้างฟอร์ม">สร้างฟอร์ม</h2>

<p>หลังจากที่ได้ไฟล์จากการ gii crud แล้วเราจะทำการปรับปรุงฟอร์มเพิ่มเติมเพื่อให้สามารถ upload file ได้</p>

<p>เปิดไฟล์ <code>views\photo-library\_form.php</code> เพิ่มแท็ก  <code>enctype</code> เข้าไป</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="nv">$form</span> <span class="o">=</span> <span class="nx">ActiveForm</span><span class="o">::</span><span class="na">begin</span><span class="p">([</span><span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;enctype&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;multipart/form-data&#39;</span><span class="p">]]);</span> <span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>แก้ไขฟิวด์ ref ให้เป็น hidenInput และเซ็ตค่า label เป็น false</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">hiddenInput</span><span class="p">([</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">label</span><span class="p">(</span><span class="k">false</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>ทำการเรียกใช้งาน Select2 widget เพื่อแสดงรายชื่อจังหวัดจาก model <code>Province</code></p>

<blockquote>
<p>โครงสร้างตาราง province <a href="https://github.com/dimpled/Yii2-Learning-Source/blob/master/yii2-learning-source.sql">ดูได้ที่นี่</a></p>
</blockquote>

<p>เรียกใช้งาน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;province_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span><span class="nx">Select2</span><span class="o">::</span><span class="na">classname</span><span class="p">(),</span> <span class="p">[</span>
    <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">ArrayHelper</span><span class="o">::</span><span class="na">map</span><span class="p">(</span><span class="nx">province</span><span class="o">::</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span><span class="s1">&#39;PROVINCE_ID&#39;</span><span class="p">,</span><span class="s1">&#39;PROVINCE_NAME&#39;</span><span class="p">),</span>
    <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;เลือกจังหวัด ...&#39;</span><span class="p">],</span>
    <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;allowClear&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
    <span class="p">],</span>
<span class="p">]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>เรียกใช้งาน DatePicker ของ kartik</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">&lt;div class=&quot;row&quot;&gt;</span>
<span class="x">         &lt;div class=&quot;col-sm-6 col-md-6&quot;&gt;</span>
<span class="x">          </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;start_date&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span>
         <span class="nx">DatePicker</span><span class="o">::</span><span class="na">className</span><span class="p">(),</span> <span class="p">[</span>
             <span class="s1">&#39;language&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span>
              <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Select issue date ...&#39;</span><span class="p">],</span>
             <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                 <span class="s1">&#39;format&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yyyy-mm-dd&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;todayHighlight&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
             <span class="p">]</span>
     <span class="p">]);</span><span class="cp">?&gt;</span><span class="x"></span>
<span class="x">         &lt;/div&gt;</span>
<span class="x">         &lt;div class=&quot;col-sm-6 col-md-6&quot;&gt;</span>
<span class="x">          </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;end_date&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span>
         <span class="nx">DatePicker</span><span class="o">::</span><span class="na">className</span><span class="p">(),</span> <span class="p">[</span>
             <span class="s1">&#39;language&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span>
              <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Select issue date ...&#39;</span><span class="p">],</span>
             <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                 <span class="s1">&#39;format&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yyyy-mm-dd&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;todayHighlight&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
             <span class="p">]</span>
     <span class="p">]);</span><span class="cp">?&gt;</span><span class="x"></span>
<span class="x">         &lt;/div&gt;</span>
<span class="x"> &lt;/div&gt;</span>
</code></pre></div>
<p>เรียกใช้งาน FileUpload เพื่อสร้างฟอร์ม upload ajax โดยตัวอย่างนี้จะใช้เฉพาะกับรูปภาพ ซึ่งจริงๆ แล้วเราสามารถกำหนดให้อัพโหลดเป็นไฟล์อะไรก็ได้
<code>FileInput::widget()</code> มี property ที่จำเป็นดังนี้
- <code>overwriteInitial</code>  กำหนดให้สามารถเพิ่มไฟล์อัพโหลดใหม่เข้าไปได้โดยที่ไม่ลบรายการเก่าออกไป
- <code>initialPreviewShowDelete</code> ถ้าโหลดไฟล์มาแสดงให้ทำการแสดงปุ่มลบด้วย
- <code>initialPreview</code> รายการรูปภาพที่เราจะมาแสดงใน thumbnail  ซึ่งรับค่าเป็น array html tag img
- <code>initialPreviewConfig</code> ค่าคอนฟิกสำหรับตอนแสดง thumbnail เช่น url ที่ลบไฟล์
- <code>uploadUrl</code>  url ที่เราจะส่งไฟล์ไปอัพโหลดแบบ ajax
- <code>uploadExtraData</code> เราสามารถส่งค่าตัวแปรแนบไปกับการอัพโหลดได้</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">&lt;div class=&quot;form-group field-upload_files&quot;&gt;</span>
<span class="x">      &lt;label class=&quot;control-label&quot; for=&quot;upload_files[]&quot;&gt; ภาพถ่าย &lt;/label&gt;</span>
<span class="x">    &lt;div&gt;</span>
<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">FileInput</span><span class="o">::</span><span class="na">widget</span><span class="p">([</span>
                   <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;upload_ajax[]&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;multiple&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span><span class="s1">&#39;accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/*&#39;</span><span class="p">],</span> <span class="c1">//&#39;accept&#39; =&gt; &#39;image/*&#39; หากต้องเฉพาะ image</span>
                    <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s1">&#39;overwriteInitial&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">,</span>
                        <span class="s1">&#39;initialPreviewShowDelete&#39;</span><span class="o">=&gt;</span><span class="k">true</span><span class="p">,</span>
                        <span class="s1">&#39;initialPreview&#39;</span><span class="o">=&gt;</span> <span class="nv">$initialPreview</span><span class="p">,</span>
                        <span class="s1">&#39;initialPreviewConfig&#39;</span><span class="o">=&gt;</span> <span class="nv">$initialPreviewConfig</span><span class="p">,</span>
                        <span class="s1">&#39;uploadUrl&#39;</span> <span class="o">=&gt;</span> <span class="nx">Url</span><span class="o">::</span><span class="na">to</span><span class="p">([</span><span class="s1">&#39;/photo-library/upload-ajax&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;uploadExtraData&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                            <span class="s1">&#39;ref&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="p">,</span>
                        <span class="p">],</span>
                        <span class="s1">&#39;maxFileCount&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span>
                    <span class="p">]</span>
                <span class="p">]);</span>
    <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>
</code></pre></div>
<p>ดูโค้ดที่ปรับแต่งทั้งหมด</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">yii\helpers\Html</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\helpers\Url</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\widgets\ActiveForm</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\helpers\ArrayHelper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">app\models\Province</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">kartik\widgets\Select2</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">kartik\widgets\FileInput</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">kartik\date\DatePicker</span><span class="p">;</span>
<span class="cm">/* @var $this yii\web\View */</span>
<span class="cm">/* @var $model app\models\PhotoLibrary */</span>
<span class="cm">/* @var $form yii\widgets\ActiveForm */</span>
<span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;div class=&quot;photo-library-form&quot;&gt;</span>

<span class="cp">&lt;?php</span> <span class="nv">$form</span> <span class="o">=</span> <span class="nx">ActiveForm</span><span class="o">::</span><span class="na">begin</span><span class="p">([</span><span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;enctype&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;multipart/form-data&#39;</span><span class="p">]]);</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span><span class="nv">$form</span><span class="o">-&gt;</span><span class="na">errorSummary</span><span class="p">(</span><span class="nv">$model</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;ref&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">hiddenInput</span><span class="p">([</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">50</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">label</span><span class="p">(</span><span class="k">false</span><span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;event_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">textInput</span><span class="p">([</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">textarea</span><span class="p">([</span><span class="s1">&#39;rows&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">     &lt;div class=&quot;row&quot;&gt;</span>
<span class="x">            &lt;div class=&quot;col-sm-6 col-md-6&quot;&gt;</span>
<span class="x">             </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;start_date&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span>
            <span class="nx">DatePicker</span><span class="o">::</span><span class="na">className</span><span class="p">(),</span> <span class="p">[</span>
                <span class="s1">&#39;language&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Select issue date ...&#39;</span><span class="p">],</span>
                <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s1">&#39;format&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yyyy-mm-dd&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;todayHighlight&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
                <span class="p">]</span>
        <span class="p">]);</span><span class="cp">?&gt;</span><span class="x"></span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">            &lt;div class=&quot;col-sm-6 col-md-6&quot;&gt;</span>
<span class="x">             </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;end_date&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span>
            <span class="nx">DatePicker</span><span class="o">::</span><span class="na">className</span><span class="p">(),</span> <span class="p">[</span>
                <span class="s1">&#39;language&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Select issue date ...&#39;</span><span class="p">],</span>
                <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s1">&#39;format&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;yyyy-mm-dd&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;todayHighlight&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
                <span class="p">]</span>
        <span class="p">]);</span><span class="cp">?&gt;</span><span class="x"></span>
<span class="x">            &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;location&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">textInput</span><span class="p">([</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;province_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">widget</span><span class="p">(</span><span class="nx">Select2</span><span class="o">::</span><span class="na">classname</span><span class="p">(),</span> <span class="p">[</span>
        <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nx">ArrayHelper</span><span class="o">::</span><span class="na">map</span><span class="p">(</span><span class="nx">province</span><span class="o">::</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span><span class="s1">&#39;PROVINCE_ID&#39;</span><span class="p">,</span><span class="s1">&#39;PROVINCE_NAME&#39;</span><span class="p">),</span>
        <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;placeholder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;เลือกจังหวัด ...&#39;</span><span class="p">],</span>
        <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;allowClear&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">],</span>
    <span class="p">]);</span>
    <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;div class=&quot;row&quot;&gt;</span>
<span class="x">        &lt;div class=&quot;col-sm-6 col-md-6&quot;&gt;</span>
<span class="x">            </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;customer_name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">textInput</span><span class="p">([</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">150</span><span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">        &lt;div class=&quot;col-sm-6 col-md-6&quot;&gt;</span>
<span class="x">            </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$form</span><span class="o">-&gt;</span><span class="na">field</span><span class="p">(</span><span class="nv">$model</span><span class="p">,</span> <span class="s1">&#39;customer_mobile_phone&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">textInput</span><span class="p">([</span><span class="s1">&#39;maxlength&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">        &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="x">   &lt;div class=&quot;form-group field-upload_files&quot;&gt;</span>
<span class="x">      &lt;label class=&quot;control-label&quot; for=&quot;upload_files[]&quot;&gt; ภาพถ่าย &lt;/label&gt;</span>
<span class="x">    &lt;div&gt;</span>
<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">FileInput</span><span class="o">::</span><span class="na">widget</span><span class="p">([</span>
                   <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;upload_ajax[]&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;multiple&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span><span class="s1">&#39;accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;image/*&#39;</span><span class="p">],</span> <span class="c1">//&#39;accept&#39; =&gt; &#39;image/*&#39; หากต้องเฉพาะ image</span>
                    <span class="s1">&#39;pluginOptions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                        <span class="s1">&#39;overwriteInitial&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">,</span>
                        <span class="s1">&#39;initialPreviewShowDelete&#39;</span><span class="o">=&gt;</span><span class="k">true</span><span class="p">,</span>
                       <span class="s1">&#39;initialPreview&#39;</span><span class="o">=&gt;</span> <span class="nv">$initialPreview</span><span class="p">,</span>
                        <span class="s1">&#39;initialPreviewConfig&#39;</span><span class="o">=&gt;</span> <span class="nv">$initialPreviewConfig</span><span class="p">,</span>
                        <span class="s1">&#39;uploadUrl&#39;</span> <span class="o">=&gt;</span> <span class="nx">Url</span><span class="o">::</span><span class="na">to</span><span class="p">([</span><span class="s1">&#39;/photo-library/upload-ajax&#39;</span><span class="p">]),</span>
                        <span class="s1">&#39;uploadExtraData&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                            <span class="s1">&#39;ref&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="p">,</span>
                        <span class="p">],</span>
                        <span class="s1">&#39;maxFileCount&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span>
                    <span class="p">]</span>
                <span class="p">]);</span>
    <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>
<span class="x">    &lt;/div&gt;</span>

<span class="x">    &lt;div class=&quot;form-group&quot;&gt;</span>
<span class="x">        </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">Html</span><span class="o">::</span><span class="na">submitButton</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">isNewRecord</span> <span class="o">?</span> <span class="s1">&#39;Create&#39;</span> <span class="o">:</span> <span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">isNewRecord</span> <span class="o">?</span> <span class="s1">&#39;btn btn-success&#39;</span> <span class="o">:</span> <span class="s1">&#39;btn btn-primary&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39; btn-lg btn-block&#39;</span><span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>
<span class="x">    &lt;/div&gt;</span>

<span class="x">    </span><span class="cp">&lt;?php</span> <span class="nx">ActiveForm</span><span class="o">::</span><span class="na">end</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<p>แก้ไขไฟล์ <code>views/photo-library/create.php</code></p>

<p>เราจะทำการส่งค่า <code>initialPreview</code> และ <code>initialPreviewConfig</code> เป็น array ว่างๆ ไปเพราะในตอน create ยังไม่มีข้อมูลที่จะแสดง เราจึงจำเป็นต้องส่ง array ว่างๆ ไปก่อน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">yii\helpers\Html</span><span class="p">;</span>
<span class="cm">/* @var $this yii\web\View */</span>
<span class="cm">/* @var $model app\models\PhotoLibrary */</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;Create Photo Library&#39;</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;breadcrumbs&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Photo Libraries&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]];</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;breadcrumbs&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;div class=&quot;photo-library-create&quot;&gt;</span>

<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">Html</span><span class="o">::</span><span class="na">encode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&lt;/h1&gt;</span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;_form&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="p">,</span>
        <span class="s1">&#39;initialPreview&#39;</span><span class="o">=&gt;</span><span class="p">[],</span>
        <span class="s1">&#39;initialPreviewConfig&#39;</span><span class="o">=&gt;</span><span class="p">[]</span>
    <span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<p>แก้ไขไฟล์ <code>views/photo-library/update.php</code> ใน actionUpdate เราจะทำการส่งค่า <code>initialPreview</code> และ <code>initialPreviewConfig</code>  ไปเพื่อให้ widget แสดง thumbnail รูปภาพที่เคยอัพโหลดไปแล้ว แต่ในตอนนี้เรายังไม่ได้สร้างฟังชันเราจะส่ง array ว่างๆ  ไปก่อน</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">yii\helpers\Html</span><span class="p">;</span>
<span class="cm">/* @var $this yii\web\View */</span>
<span class="cm">/* @var $model app\models\PhotoLibrary */</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;Update Photo Library: &#39;</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;breadcrumbs&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Photo Libraries&#39;</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]];</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;breadcrumbs&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;label&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]];</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">&#39;breadcrumbs&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="s1">&#39;Update&#39;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;div class=&quot;photo-library-update&quot;&gt;</span>

<span class="x">    &lt;h1&gt;</span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">Html</span><span class="o">::</span><span class="na">encode</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="x">&lt;/h1&gt;</span>

<span class="x">    </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;_form&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="p">,</span>
        <span class="s1">&#39;initialPreview&#39;</span><span class="o">=&gt;</span><span class="p">[],</span>
        <span class="s1">&#39;initialPreviewConfig&#39;</span><span class="o">=&gt;</span><span class="p">[]</span>
    <span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>

<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<p>ลองทดสอบรันจะได้ฟอร์มตามตัวอย่างนี้
<img src="/img/upload-file/upload-ajax-form.png" alt=""></p>

<h2 id="เพิ่ม-function-ใน-model-photolibrary">เพิ่ม function ใน Model PhotoLibrary</h2>

<ul>
<li>UPLOAD_FOLDER เป็นตัวแปร static ให้เรากำหนดชื่อโฟลเดอร์ที่ต้องการอัพโหลดได้</li>
<li>getUploadPath()  เป็นฟังก์ชันไว้เรียกพาทไฟล์จริงใน server</li>
<li>getUploadUrl()  เป็นฟังก์ชันไว้เรียก url จริงของไฟล์</li>
<li>getThumbnails()  เป็นฟังก์ชันส่งข้อมูล array ให้ widget Gallry เพื่อแสดง thumbnail</li>
<li>getProvince() เป็นการสร้าง relation ไปยังตาราง province ด้วยฟิวด์ province_id เพื่อดึงชื่อจังหวัดมาแสดง</li>
</ul>

<p>ให้ทำการเพิ่ม function  เข้าไปที่ไฟล์ <code>models\PhotoLibrary.php</code> ดังนี้</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">const UPLOAD_FOLDER=&#39;photolibrarys&#39;;</span>

<span class="x">// ..........</span>

<span class="x">public static function getUploadPath(){</span>
<span class="x">    return Yii::getAlias(&#39;@webroot&#39;).&#39;/&#39;.self::UPLOAD_FOLDER.&#39;/&#39;;</span>
<span class="x">}</span>

<span class="x">public static function getUploadUrl(){</span>
<span class="x">    return Url::base(true).&#39;/&#39;.self::UPLOAD_FOLDER.&#39;/&#39;;</span>
<span class="x">}</span>

<span class="x">public function getThumbnails($ref,$event_name){</span>
<span class="x">     $uploadFiles   = Uploads::find()-&gt;where([&#39;ref&#39;=&gt;$ref])-&gt;all();</span>
<span class="x">     $preview = [];</span>
<span class="x">    foreach ($uploadFiles as $file) {</span>
<span class="x">        $preview[] = [</span>
<span class="x">            &#39;url&#39;=&gt;self::getUploadUrl(true).$ref.&#39;/&#39;.$file-&gt;real_filename,</span>
<span class="x">            &#39;src&#39;=&gt;self::getUploadUrl(true).$ref.&#39;/thumbnail/&#39;.$file-&gt;real_filename,</span>
<span class="x">            &#39;options&#39; =&gt; [&#39;title&#39; =&gt; $event_name]</span>
<span class="x">        ];</span>
<span class="x">    }</span>
<span class="x">    return $preview;</span>
<span class="x">}</span>

<span class="x">public function getProvince()</span>
<span class="x">{</span>
<span class="x">  return $this-&gt;hasOne(Province::className(),[&#39;PROVINCE_ID&#39;=&gt;&#39;province_id&#39;]);</span>
<span class="x">}</span>
</code></pre></div>
<h2 id="สร้าง-function-ใน-controller-photolibrary-สำหรับการอัพโหลด-ajax">สร้าง Function ใน Controller PhotoLibrary สำหรับการอัพโหลด Ajax</h2>

<p><code>Uploads()</code> ฟังก์ชันนี้มีหน้าทีรับไฟล์จาก ajax from แล้วส่งข้อมูลมาทำการอัพโหลดไฟล์ สามารถอัพได้ทั้งภาพและไฟล์ ถ้าเป็นภาพจะทำการ resize และสร้าง thumbnail ให้</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">private function Uploads($isAjax=false) {</span>
<span class="x">             if (Yii::$app-&gt;request-&gt;isPost) {</span>
<span class="x">                $images = UploadedFile::getInstancesByName(&#39;upload_ajax&#39;);</span>
<span class="x">                if ($images) {</span>

<span class="x">                    if($isAjax===true){</span>
<span class="x">                        $ref =Yii::$app-&gt;request-&gt;post(&#39;ref&#39;);</span>
<span class="x">                    }else{</span>
<span class="x">                        $Freelance = Yii::$app-&gt;request-&gt;post(&#39;Freelance&#39;);</span>
<span class="x">                        $ref = $Freelance[&#39;ref&#39;];</span>
<span class="x">                    }</span>

<span class="x">                    $this-&gt;CreateDir($ref);</span>

<span class="x">                    foreach ($images as $file){</span>
<span class="x">                        $fileName       = $file-&gt;baseName . &#39;.&#39; . $file-&gt;extension;</span>
<span class="x">                        $realFileName   = md5($file-&gt;baseName.time()) . &#39;.&#39; . $file-&gt;extension;</span>
<span class="x">                        $savePath       = Freelance::UPLOAD_FOLDER.&#39;/&#39;.$ref.&#39;/&#39;. $realFileName;</span>
<span class="x">                        if($file-&gt;saveAs($savePath)){</span>

<span class="x">                            if($this-&gt;isImage(Url::base(true).&#39;/&#39;.$savePath)){</span>
<span class="x">                                 $this-&gt;createThumbnail($ref,$realFileName);</span>
<span class="x">                            }</span>

<span class="x">                            $model                  = new Uploads;</span>
<span class="x">                            $model-&gt;ref             = $ref;</span>
<span class="x">                            $model-&gt;file_name       = $fileName;</span>
<span class="x">                            $model-&gt;real_filename   = $realFileName;</span>
<span class="x">                            $model-&gt;save();</span>

<span class="x">                            if($isAjax===true){</span>
<span class="x">                                echo json_encode([&#39;success&#39; =&gt; &#39;true&#39;]);</span>
<span class="x">                            }</span>

<span class="x">                        }else{</span>
<span class="x">                            if($isAjax===true){</span>
<span class="x">                                echo json_encode([&#39;success&#39;=&gt;&#39;false&#39;,&#39;eror&#39;=&gt;$file-&gt;error]);</span>
<span class="x">                            }</span>
<span class="x">                        }</span>

<span class="x">                    }</span>
<span class="x">                }</span>
<span class="x">            }</span>
<span class="x">    }</span>
</code></pre></div>
<p><code>getInitialPreview()</code> ฟังก์ชันนี้เอาไว้ดึงรายการข้อมูลของตาราง <code>Uploads</code> เพื่อแสดงที่ thumbnail ตรงอัพโหลดในตอนที่มีการแก้ไขข้อมูล</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">  private function getInitialPreview($ref) {</span>
<span class="x">        $datas = Uploads::find()-&gt;where([&#39;ref&#39;=&gt;$ref])-&gt;all();</span>
<span class="x">        $initialPreview = [];</span>
<span class="x">        $initialPreviewConfig = [];</span>
<span class="x">        foreach ($datas as $key =&gt; $value) {</span>
<span class="x">            array_push($initialPreview, $this-&gt;getTemplatePreview($value));</span>
<span class="x">            array_push($initialPreviewConfig, [</span>
<span class="x">                &#39;caption&#39;=&gt; $value-&gt;file_name,</span>
<span class="x">                &#39;width&#39;  =&gt; &#39;120px&#39;,</span>
<span class="x">                &#39;url&#39;    =&gt; Url::to([&#39;/freelance/deletefile-ajax&#39;]),</span>
<span class="x">                &#39;key&#39;    =&gt; $value-&gt;upload_id</span>
<span class="x">            ]);</span>
<span class="x">        }</span>
<span class="x">        return  [$initialPreview,$initialPreviewConfig];</span>
<span class="x">}</span>
</code></pre></div>
<p><code>isImage()</code> ฟังก์ชันนี้เอาไว้แยกแยะระหว่างไฟล์และรูปภาพ</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">public function isImage($filePath){</span>
<span class="x">        return @is_array(getimagesize($filePath)) ? true : false;</span>
<span class="x">}</span>
</code></pre></div>
<p><code>getTemplatePreview()</code> เอาไว้เลือก template ที่จะแสดงผลว่าเป็น image หรือไฟล์อื่นๆ</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">private function getTemplatePreview(Uploads $model){</span>
<span class="x">        $filePath = Freelance::getUploadUrl().$model-&gt;ref.&#39;/thumbnail/&#39;.$model-&gt;real_filename;</span>
<span class="x">        $isImage  = $this-&gt;isImage($filePath);</span>
<span class="x">        if($isImage){</span>
<span class="x">            $file = Html::img($filePath,[&#39;class&#39;=&gt;&#39;file-preview-image&#39;, &#39;alt&#39;=&gt;$model-&gt;file_name, &#39;title&#39;=&gt;$model-&gt;file_name]);</span>
<span class="x">        }else{</span>
<span class="x">            $file =  &quot;&lt;div class=&#39;file-preview-other&#39;&gt; &quot; .</span>
<span class="x">                     &quot;&lt;h2&gt;&lt;i class=&#39;glyphicon glyphicon-file&#39;&gt;&lt;/i&gt;&lt;/h2&gt;&quot; .</span>
<span class="x">                     &quot;&lt;/div&gt;&quot;;</span>
<span class="x">        }</span>
<span class="x">        return $file;</span>
<span class="x">}</span>
</code></pre></div>
<p><code>createThumbnail()</code> เป็น function ที่เอาไว้สร้าง thumbnail เล็กๆ เพื่อให้สามารถแสดงผลได้เร็ว</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">private function createThumbnail($folderName,$fileName,$width=250){</span>
<span class="x">  $uploadPath   = Freelance::getUploadPath().&#39;/&#39;.$folderName.&#39;/&#39;;</span>
<span class="x">  $file         = $uploadPath.$fileName;</span>
<span class="x">  $image        = Yii::$app-&gt;image-&gt;load($file);</span>
<span class="x">  $image-&gt;resize($width);</span>
<span class="x">  $image-&gt;save($uploadPath.&#39;thumbnail/&#39;.$fileName);</span>
<span class="x">  return;</span>
<span class="x">}</span>
</code></pre></div>
<p><code>actionDeletefileAjax()</code> เป็น action ที่เอาไว้ลบไฟล์ในกรณีที่คลิกลบไฟล์ จาก thumbnail ในตัวอัพโหลด ajax</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">public function actionDeletefileAjax(){</span>

<span class="x">    $model = Uploads::findOne(Yii::$app-&gt;request-&gt;post(&#39;key&#39;));</span>
<span class="x">    if($model!==NULL){</span>
<span class="x">        $filename  = Freelance::getUploadPath().$model-&gt;ref.&#39;/&#39;.$model-&gt;real_filename;</span>
<span class="x">        $thumbnail = Freelance::getUploadPath().$model-&gt;ref.&#39;/thumbnail/&#39;.$model-&gt;real_filename;</span>
<span class="x">        if($model-&gt;delete()){</span>
<span class="x">            @unlink($filename);</span>
<span class="x">            @unlink($thumbnail);</span>
<span class="x">            echo json_encode([&#39;success&#39;=&gt;true]);</span>
<span class="x">        }else{</span>
<span class="x">            echo json_encode([&#39;success&#39;=&gt;false]);</span>
<span class="x">        }</span>
<span class="x">    }else{</span>
<span class="x">      echo json_encode([&#39;success&#39;=&gt;false]);  </span>
<span class="x">    }</span>
<span class="x">}</span>
</code></pre></div>
<p>เป็นฟังก์ชันลบ folder ที่ใช้เก็บไฟล์ เราจะใช้ในกรณีหากมีการลบ record ก็ให้ตามไปลบไฟล์ทั้งหมดด้วย</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">private function removeUploadDir($dir){</span>
<span class="x">    BaseFileHelper::removeDirectory(Freelance::getUploadPath().$dir);</span>
<span class="x">}</span>
</code></pre></div>
<p>สุดท้ายทำการปรับปรุง actionDelete() ซักเล็กน้อย โดยหากมีการลบ record ก็ให้ทำการลบโฟล์เดอร์ที่เก็บไฟล์นั้นด้วย โดยใช้ <code>removeUploadDir()</code> ที่เราสร้างไว้แล้วก่อนหน้านี้</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">public function actionDelete($id)</span>
<span class="x">{</span>
<span class="x">    $model = $this-&gt;findModel($id);</span>
<span class="x">    //remove upload file &amp; data</span>
<span class="x">    $this-&gt;removeUploadDir($model-&gt;ref);</span>
<span class="x">    Uploads::deleteAll([&#39;ref&#39;=&gt;$model-&gt;ref]);</span>

<span class="x">    $model-&gt;delete();</span>

<span class="x">    return $this-&gt;redirect([&#39;index&#39;]);</span>
<span class="x">}</span>
</code></pre></div>
<h2 id="สร้าง-actionuploadajax">สร้าง actionUploadAjax</h2>

<p>เป็น function ที่เอาไว้รองรับการอัพโหลดไฟล์ผ่าน ajax ซึ่งเราจะใช้ Upload() ที่เราสร้างไว้ โดยรับค่า parameter 1 ตัวคือ $isAjax เพื่อไปเช็คว่าเป็นการอัพโหลดผ่าน ajax หรือผ่านการ submission form จากนั้นให้ทดลองทำการอัพโหลดไฟล์ลองดู
<code>php
public function actionUploadAjax(){
       $this-&gt;Uploads(true);
}
</code></p>

<h2 id="เรียกใช้งานที่-actioncreate-และ-actionupdate">เรียกใช้งานที่ actionCreate และ actionUpdate</h2>

<p>ปรับปรุงให้ action เดิมๆ สามารถรองรับการอัพโหลดจากฟอร์ม ajax ได้ เพราะหากเค้าไม่คลิกปุ่มอัพโหลด ajax แล้วข้อมูลจะยังไม่ถูกอัพโหลด เราจะแก้ไขโดยการเรียกใช้งาน function Upload() ที่เราได้สร้างไว้และใช้กับ actionUploadAjax() ซึ่งสามารถนำมาใช้กับ acionCreate และ  actionUpdate ได้</p>

<p>โดยเพิ่ม <code>this-&gt;Uploads(false);</code>เข้าไป</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">public function actionCreate()</span>
<span class="x">{</span>
<span class="x">    $model = new PhotoLibrary();</span>

<span class="x">    if ($model-&gt;load(Yii::$app-&gt;request-&gt;post()) ) {</span>

<span class="x">        $this-&gt;Uploads(false);</span>

<span class="x">        if($model-&gt;save()){</span>
<span class="x">             return $this-&gt;redirect([&#39;view&#39;, &#39;id&#39; =&gt; $model-&gt;id]);</span>
<span class="x">        }</span>

<span class="x">    } else {</span>
<span class="x">         $model-&gt;ref = substr(Yii::$app-&gt;getSecurity()-&gt;generateRandomString(),10);</span>
<span class="x">    }</span>

<span class="x">    return $this-&gt;render(&#39;create&#39;, [</span>
<span class="x">        &#39;model&#39; =&gt; $model,</span>
<span class="x">    ]);</span>

<span class="x">}</span>
</code></pre></div>
<p>ส่วน actionUpdate() เพิ่ม getInitialPreview() เข้ามาด้วยเพื่อใช้แสดง thumbnail ในตัว ajax upload</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">public function actionUpdate($id)</span>
<span class="x"> {</span>
<span class="x">     $model = $this-&gt;findModel($id);</span>

<span class="x">     list($initialPreview,$initialPreviewConfig) = $this-&gt;getInitialPreview($model-&gt;ref);</span>

<span class="x">     if ($model-&gt;load(Yii::$app-&gt;request-&gt;post())) {</span>
<span class="x">         $this-&gt;Uploads(false);</span>

<span class="x">         if($model-&gt;save()){</span>
<span class="x">              return $this-&gt;redirect([&#39;view&#39;, &#39;id&#39; =&gt; $model-&gt;id]);</span>
<span class="x">         }</span>
<span class="x">     }</span>

<span class="x">     return $this-&gt;render(&#39;update&#39;, [</span>
<span class="x">         &#39;model&#39; =&gt; $model,</span>
<span class="x">          &#39;initialPreview&#39;=&gt;$initialPreview,</span>
<span class="x">          &#39;initialPreviewConfig&#39;=&gt;$initialPreviewConfig</span>
<span class="x">     ]);</span>

<span class="x"> }</span>
</code></pre></div>
<p>และแก้ไขไฟล์เพิ่มเติม views/freelance/create.php</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?</span><span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;_form&#39;</span><span class="p">,</span> <span class="p">[</span>
       <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="p">,</span>
       <span class="s1">&#39;initialPreview&#39;</span><span class="o">=&gt;</span> <span class="p">[],</span>
       <span class="s1">&#39;initialPreviewConfig&#39;</span><span class="o">=&gt;</span> <span class="p">[],</span>
   <span class="p">])</span> <span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>
<p>และแก้ไขไฟล์ views/freelance/update.php
<code>php
&lt;?= $this-&gt;render(&#39;_form&#39;, [
    &#39;model&#39; =&gt; $model,
    &#39;initialPreview&#39;=&gt;$initialPreview,
    &#39;initialPreviewConfig&#39;=&gt;$initialPreviewConfig
]) ?&gt;
</code></p>

<p>โค้ดทั้งหมด ใน PhotolibraryController()</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">app\Controllers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Yii</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">app\models\Uploads</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">app\models\PhotoLibrary</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">app\models\PhotoLibrarySearch</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\web\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\web\NotFoundHttpException</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\filters\VerbFilter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">yii\helpers\Url</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\helpers\html</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\web\UploadedFile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\helpers\BaseFileHelper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\helpers\Json</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">yii\helpers\ArrayHelper</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * PhotoLibraryController implements the CRUD actions for PhotoLibrary model.</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">PhotoLibraryController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">behaviors</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;verbs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;class&#39;</span> <span class="o">=&gt;</span> <span class="nx">VerbFilter</span><span class="o">::</span><span class="na">className</span><span class="p">(),</span>
                <span class="s1">&#39;actions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s1">&#39;delete&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">],</span>
                <span class="p">],</span>
            <span class="p">],</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Lists all PhotoLibrary models.</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$searchModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PhotoLibrarySearch</span><span class="p">();</span>
        <span class="nv">$dataProvider</span> <span class="o">=</span> <span class="nv">$searchModel</span><span class="o">-&gt;</span><span class="na">search</span><span class="p">(</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">queryParams</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;searchModel&#39;</span> <span class="o">=&gt;</span> <span class="nv">$searchModel</span><span class="p">,</span>
            <span class="s1">&#39;dataProvider&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dataProvider</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Displays a single PhotoLibrary model.</span>
<span class="sd">     * @param integer $id</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionView</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">findModel</span><span class="p">(</span><span class="nv">$id</span><span class="p">),</span>
        <span class="p">]);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Creates a new PhotoLibrary model.</span>
<span class="sd">     * If creation is successful, the browser will be redirected to the &#39;view&#39; page.</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionCreate</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PhotoLibrary</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">())</span> <span class="p">)</span> <span class="p">{</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Uploads</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">()){</span>
                 <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">([</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
             <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">getSecurity</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">generateRandomString</span><span class="p">(),</span><span class="mi">10</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="p">,</span>
        <span class="p">]);</span>

    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Updates an existing PhotoLibrary model.</span>
<span class="sd">     * If update is successful, the browser will be redirected to the &#39;view&#39; page.</span>
<span class="sd">     * @param integer $id</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionUpdate</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">findModel</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">list</span><span class="p">(</span><span class="nv">$initialPreview</span><span class="p">,</span><span class="nv">$initialPreviewConfig</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getInitialPreview</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">()))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Uploads</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

            <span class="k">if</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">()){</span>
                 <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">([</span><span class="s1">&#39;view&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="p">,</span>
             <span class="s1">&#39;initialPreview&#39;</span><span class="o">=&gt;</span><span class="nv">$initialPreview</span><span class="p">,</span>
             <span class="s1">&#39;initialPreviewConfig&#39;</span><span class="o">=&gt;</span><span class="nv">$initialPreviewConfig</span>
        <span class="p">]);</span>

    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Deletes an existing PhotoLibrary model.</span>
<span class="sd">     * If deletion is successful, the browser will be redirected to the &#39;index&#39; page.</span>
<span class="sd">     * @param integer $id</span>
<span class="sd">     * @return mixed</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionDelete</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">findModel</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="c1">//remove upload file &amp; data</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">removeUploadDir</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="p">);</span>
        <span class="nx">Uploads</span><span class="o">::</span><span class="na">deleteAll</span><span class="p">([</span><span class="s1">&#39;ref&#39;</span><span class="o">=&gt;</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="p">]);</span>

        <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">([</span><span class="s1">&#39;index&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * Finds the PhotoLibrary model based on its primary key value.</span>
<span class="sd">     * If the model is not found, a 404 HTTP exception will be thrown.</span>
<span class="sd">     * @param integer $id</span>
<span class="sd">     * @return PhotoLibrary the loaded model</span>
<span class="sd">     * @throws NotFoundHttpException if the model cannot be found</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">findModel</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nv">$model</span> <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">findOne</span><span class="p">(</span><span class="nv">$id</span><span class="p">))</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$model</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">NotFoundHttpException</span><span class="p">(</span><span class="s1">&#39;The requested page does not exist.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="cm">/*|*********************************************************************************|</span>
<span class="cm">  |================================ Upload Ajax ====================================|</span>
<span class="cm">  |*********************************************************************************|*/</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionUploadAjax</span><span class="p">(){</span>
           <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Uploads</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
     <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">CreateDir</span><span class="p">(</span><span class="nv">$folderName</span><span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$folderName</span> <span class="o">!=</span> <span class="k">NULL</span><span class="p">){</span>
            <span class="nv">$basePath</span> <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">getUploadPath</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">BaseFileHelper</span><span class="o">::</span><span class="na">createDirectory</span><span class="p">(</span><span class="nv">$basePath</span><span class="o">.</span><span class="nv">$folderName</span><span class="p">,</span><span class="mo">0777</span><span class="p">)){</span>
                <span class="nx">BaseFileHelper</span><span class="o">::</span><span class="na">createDirectory</span><span class="p">(</span><span class="nv">$basePath</span><span class="o">.</span><span class="nv">$folderName</span><span class="o">.</span><span class="s1">&#39;/thumbnail&#39;</span><span class="p">,</span><span class="mo">0777</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">removeUploadDir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">){</span>
        <span class="nx">BaseFileHelper</span><span class="o">::</span><span class="na">removeDirectory</span><span class="p">(</span><span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">getUploadPath</span><span class="p">()</span><span class="o">.</span><span class="nv">$dir</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">Uploads</span><span class="p">(</span><span class="nv">$isAjax</span><span class="o">=</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
             <span class="k">if</span> <span class="p">(</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$images</span> <span class="o">=</span> <span class="nx">UploadedFile</span><span class="o">::</span><span class="na">getInstancesByName</span><span class="p">(</span><span class="s1">&#39;upload_ajax&#39;</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$images</span><span class="p">)</span> <span class="p">{</span>

                    <span class="k">if</span><span class="p">(</span><span class="nv">$isAjax</span><span class="o">===</span><span class="k">true</span><span class="p">){</span>
                        <span class="nv">$ref</span> <span class="o">=</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">);</span>
                    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                        <span class="nv">$PhotoLibrary</span> <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;PhotoLibrary&#39;</span><span class="p">);</span>
                        <span class="nv">$ref</span> <span class="o">=</span> <span class="nv">$PhotoLibrary</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">];</span>
                    <span class="p">}</span>

                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">CreateDir</span><span class="p">(</span><span class="nv">$ref</span><span class="p">);</span>

                    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$images</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">){</span>
                        <span class="nv">$fileName</span>       <span class="o">=</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">baseName</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">extension</span><span class="p">;</span>
                        <span class="nv">$realFileName</span>   <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">baseName</span><span class="o">.</span><span class="nb">time</span><span class="p">())</span> <span class="o">.</span> <span class="s1">&#39;.&#39;</span> <span class="o">.</span> <span class="nv">$file</span><span class="o">-&gt;</span><span class="na">extension</span><span class="p">;</span>
                        <span class="nv">$savePath</span>       <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">UPLOAD_FOLDER</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$ref</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span> <span class="nv">$realFileName</span><span class="p">;</span>
                        <span class="k">if</span><span class="p">(</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">saveAs</span><span class="p">(</span><span class="nv">$savePath</span><span class="p">)){</span>

                            <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isImage</span><span class="p">(</span><span class="nx">Url</span><span class="o">::</span><span class="na">base</span><span class="p">(</span><span class="k">true</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$savePath</span><span class="p">)){</span>
                                 <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createThumbnail</span><span class="p">(</span><span class="nv">$ref</span><span class="p">,</span><span class="nv">$realFileName</span><span class="p">);</span>
                            <span class="p">}</span>

                            <span class="nv">$model</span>                  <span class="o">=</span> <span class="k">new</span> <span class="nx">Uploads</span><span class="p">;</span>
                            <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span>             <span class="o">=</span> <span class="nv">$ref</span><span class="p">;</span>
                            <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">file_name</span>       <span class="o">=</span> <span class="nv">$fileName</span><span class="p">;</span>
                            <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">real_filename</span>   <span class="o">=</span> <span class="nv">$realFileName</span><span class="p">;</span>
                            <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

                            <span class="k">if</span><span class="p">(</span><span class="nv">$isAjax</span><span class="o">===</span><span class="k">true</span><span class="p">){</span>
                                <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;success&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;true&#39;</span><span class="p">]);</span>
                            <span class="p">}</span>

                        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                            <span class="k">if</span><span class="p">(</span><span class="nv">$isAjax</span><span class="o">===</span><span class="k">true</span><span class="p">){</span>
                                <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;success&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;false&#39;</span><span class="p">,</span><span class="s1">&#39;eror&#39;</span><span class="o">=&gt;</span><span class="nv">$file</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">]);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">getInitialPreview</span><span class="p">(</span><span class="nv">$ref</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$datas</span> <span class="o">=</span> <span class="nx">Uploads</span><span class="o">::</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;ref&#39;</span><span class="o">=&gt;</span><span class="nv">$ref</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
            <span class="nv">$initialPreview</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nv">$initialPreviewConfig</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$datas</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$initialPreview</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getTemplatePreview</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>
                <span class="nb">array_push</span><span class="p">(</span><span class="nv">$initialPreviewConfig</span><span class="p">,</span> <span class="p">[</span>
                    <span class="s1">&#39;caption&#39;</span><span class="o">=&gt;</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="na">file_name</span><span class="p">,</span>
                    <span class="s1">&#39;width&#39;</span>  <span class="o">=&gt;</span> <span class="s1">&#39;120px&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;url&#39;</span>    <span class="o">=&gt;</span> <span class="nx">Url</span><span class="o">::</span><span class="na">to</span><span class="p">([</span><span class="s1">&#39;/photo-library/deletefile-ajax&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;key&#39;</span>    <span class="o">=&gt;</span> <span class="nv">$value</span><span class="o">-&gt;</span><span class="na">upload_id</span>
                <span class="p">]);</span>
            <span class="p">}</span>
            <span class="k">return</span>  <span class="p">[</span><span class="nv">$initialPreview</span><span class="p">,</span><span class="nv">$initialPreviewConfig</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">isImage</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">){</span>
            <span class="k">return</span> <span class="o">@</span><span class="nb">is_array</span><span class="p">(</span><span class="nb">getimagesize</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">))</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">getTemplatePreview</span><span class="p">(</span><span class="nx">Uploads</span> <span class="nv">$model</span><span class="p">){</span>
            <span class="nv">$filePath</span> <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">getUploadUrl</span><span class="p">()</span><span class="o">.</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="o">.</span><span class="s1">&#39;/thumbnail/&#39;</span><span class="o">.</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">real_filename</span><span class="p">;</span>
            <span class="nv">$isImage</span>  <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">isImage</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$isImage</span><span class="p">){</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nx">Html</span><span class="o">::</span><span class="na">img</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">,[</span><span class="s1">&#39;class&#39;</span><span class="o">=&gt;</span><span class="s1">&#39;file-preview-image&#39;</span><span class="p">,</span> <span class="s1">&#39;alt&#39;</span><span class="o">=&gt;</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">file_name</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="o">=&gt;</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">file_name</span><span class="p">]);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="nv">$file</span> <span class="o">=</span>  <span class="s2">&quot;&lt;div class=&#39;file-preview-other&#39;&gt; &quot;</span> <span class="o">.</span>
                         <span class="s2">&quot;&lt;h2&gt;&lt;i class=&#39;glyphicon glyphicon-file&#39;&gt;&lt;/i&gt;&lt;/h2&gt;&quot;</span> <span class="o">.</span>
                         <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$file</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">createThumbnail</span><span class="p">(</span><span class="nv">$folderName</span><span class="p">,</span><span class="nv">$fileName</span><span class="p">,</span><span class="nv">$width</span><span class="o">=</span><span class="mi">250</span><span class="p">){</span>
      <span class="nv">$uploadPath</span>   <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">getUploadPath</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$folderName</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="p">;</span>
      <span class="nv">$file</span>         <span class="o">=</span> <span class="nv">$uploadPath</span><span class="o">.</span><span class="nv">$fileName</span><span class="p">;</span>
      <span class="nv">$image</span>        <span class="o">=</span> <span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">image</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
      <span class="nv">$image</span><span class="o">-&gt;</span><span class="na">resize</span><span class="p">(</span><span class="nv">$width</span><span class="p">);</span>
      <span class="nv">$image</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$uploadPath</span><span class="o">.</span><span class="s1">&#39;thumbnail/&#39;</span><span class="o">.</span><span class="nv">$fileName</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">actionDeletefileAjax</span><span class="p">(){</span>

        <span class="nv">$model</span> <span class="o">=</span> <span class="nx">Uploads</span><span class="o">::</span><span class="na">findOne</span><span class="p">(</span><span class="nx">Yii</span><span class="o">::</span><span class="nv">$app</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$model</span><span class="o">!==</span><span class="k">NULL</span><span class="p">){</span>
            <span class="nv">$filename</span>  <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">getUploadPath</span><span class="p">()</span><span class="o">.</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">real_filename</span><span class="p">;</span>
            <span class="nv">$thumbnail</span> <span class="o">=</span> <span class="nx">PhotoLibrary</span><span class="o">::</span><span class="na">getUploadPath</span><span class="p">()</span><span class="o">.</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="o">.</span><span class="s1">&#39;/thumbnail/&#39;</span><span class="o">.</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">real_filename</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">()){</span>
                <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
                <span class="o">@</span><span class="nb">unlink</span><span class="p">(</span><span class="nv">$thumbnail</span><span class="p">);</span>
                <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;success&#39;</span><span class="o">=&gt;</span><span class="k">true</span><span class="p">]);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;success&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">([</span><span class="s1">&#39;success&#39;</span><span class="o">=&gt;</span><span class="k">false</span><span class="p">]);</span>  
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="เพิ่ม-widget-gallery">เพิ่ม Widget Gallery</h2>

<p>เพื่อให้สามารถดูรูปภาพที่เราได้อัพโหลดไปแล้ว เราจะทำการเรียกใช้งาน widget Gallery</p>

<p>โดยเพิ่มที่ไฟล์ <code>views\photo-library\view.php</code>เพิ่มการเรียกใช้งานเข้าไปด้านล่างสุด ซึ่งเราจะเรียกใช้งาน <code>getThumbnails()</code> ที่เราได้สร้างไว้แล้วตอนแก้ไข Model PhotoLibrary</p>
<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="x">&lt;div class=&quot;panel panel-default&quot;&gt;</span>
<span class="x">  &lt;div class=&quot;panel-body&quot;&gt;</span>
<span class="x">     </span><span class="cp">&lt;?</span><span class="o">=</span> <span class="nx">dosamigos\gallery\Gallery</span><span class="o">::</span><span class="na">widget</span><span class="p">([</span><span class="s1">&#39;items&#39;</span> <span class="o">=&gt;</span> <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">getThumbnails</span><span class="p">(</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">ref</span><span class="p">,</span><span class="nv">$model</span><span class="o">-&gt;</span><span class="na">event_name</span><span class="p">)]);</span><span class="cp">?&gt;</span><span class="x"></span>
<span class="x">  &lt;/div&gt;</span>
<span class="x">&lt;/div&gt;</span>
</code></pre></div>
<h2 id="ลองใช้งาน">ลองใช้งาน</h2>

<p>หน้าหลัก
<img src="/img/upload-file/form-1.png" alt="update"></p>

<p>การสร้างและแก้ไขข้อมูล
<img src="/img/upload-file/form-2.png" alt="update"></p>

<p>หน้า preview
<img src="/img/upload-file/form-3.png" alt="update"></p>

<p>เมื่อคลิกที่รูปภาพจะแสดงเป็น gallry
<img src="/img/upload-file/form-4.png" alt="update"></p>

<p><a href="https://github.com/dimpled/Yii2-Learning-Source">ดาวน์โหลด soucrecode ได้ที่นี่</a></p>

<blockquote>
<p>ตัวอย่างอยู่ที่ PhotoLibraryController</p>
</blockquote>
</section>
</article>

<!-- Post navigation -->


<!-- Disqus -->

<div class="comments">
  <div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'dixonsatit';
	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

</div>


    </div>
    <script src="/js/main.js"></script>


<footer class="site-footer">
	<p class="text"><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Yii2 Learning</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.dimpled.me" property="cc:attributionName" rel="cc:attributionURL">Satit Seethaphon</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="http://dixonsatit.github.io" rel="dct:source">http://dixonsatit.github.io</a><br> Powered by <a href="http://jekyllrb.com">Jekyll</a> with <a href="https://rohanchandra.github.io/project/type/">Type Theme</a>
</p>
</footer>


  </body>
</html>
